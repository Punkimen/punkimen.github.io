$(".steps__aside .benefits__tabs-elem").off("click");let stepsCount=0;const nextStep=e=>{$(".steps__aside .benefits__tabs-elem").removeClass("active"),$(".steps__aside .benefits__tabs-elem").eq(e).addClass("active"),$(".steps__aside .benefits__tabs-elem.active").prev().css({border:"none"}),$(".step-item__status").eq(e).addClass("active")},snapPhoto=(e,t)=>{e.snap(),$(t).addClass("show")},webcamStartFirst=()=>{const e=document.querySelector("#webcam"),t=document.querySelector("#canvas"),a=document.querySelector("#step_2-photo-do"),o=new Webcam(e,"user",t);o.start().then((e=>{console.log("webcam started"),document.querySelector("#step_2-photo-do").disabled=!1})).catch((e=>{console.log(e),o.start()})),a.addEventListener("click",(function(){snapPhoto(o,"#canvas"),webcamStartSecond(),nextStep(3),$("#step_3-photo-do").prop("disabled",!1)}))},video=document.querySelector("#webcam_2"),canvas=document.querySelector("#canvas_2"),btn=document.querySelector("#step_3-photo-do"),parts=[];let mediaRecorder;const btnAnim=(e,t)=>{setTimeout((function(){if(e.textContent=t,!(--t>=0))return e.textContent="Thank you",e.disabled=!0,!1;btnAnim(e,t)}),1e3)},saveVideo=()=>{void 0===navigator.mediaDevices?(navigator.mediaDevices={},navigator.mediaDevices.getUserMedia=function(e){let t=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return t?new Promise((function(a,o){t.call(navigator,e,a,o)})):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}):navigator.mediaDevices.enumerateDevices().then((e=>{e.forEach((e=>{console.log(e.kind.toUpperCase(),e.label)}))})).catch((e=>{console.error(e.name,e.message)}));navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"user",width:{min:640,ideal:1280,max:1920},height:{min:480,ideal:720,max:1080}}}).then((function(e){let t=document.querySelector("#webcam_2");"srcObject"in t?t.srcObject=e:t.src=window.URL.createObjectURL(e),t.onloadedmetadata=function(e){t.play()};let a=document.querySelector("#step_3-photo-do"),o=document.getElementById("video_1"),n=new MediaRecorder(e),s=[];a.addEventListener("click",(e=>{btnAnim(document.getElementById("step_3-photo-do"),3),n.start(),setTimeout((function(){n.stop(),o.style.zIndex=3}),4e3)})),n.ondataavailable=function(e){s.push(e.data)},n.onstop=e=>{let t=new Blob(s,{type:"video/mp4;"});s=[];let a=window.URL.createObjectURL(t);o.src=a,fetch(a).then((e=>e.blob())).then((e=>{let t=URL.createObjectURL(e);const a=document.querySelector("#id_video");let o=new DataTransfer,n=new File([e],"video.mp4");o.items.add(n),a.files=o.files,URL.revokeObjectURL(t)})).catch((e=>{console.log(e)}))}})).catch((function(e){console.log(e.name,e.message)}))};document.addEventListener("DOMContentLoaded",(()=>{saveVideo(),$("#step_3-photo-do").prop("disabled",!1)})),$("#step-number").on("input",(function(){$(this).addClass("valid"),$(this).hasClass("valid")&&(nextStep(1),$("#card-verification__btn").prop("disabled",!1))}));const inpCardNum=document.querySelector("#card-num"),inpCardDate=document.querySelector("#card-date"),inpCardCvv=document.querySelector("#card-cvv"),setCardLogo=e=>{const t=e.split("");4==t[0]?($(".plastic-card__logo img").hide(),$(".plastic-card__logo_visa").show()):5==t[0]&&($(".plastic-card__logo img").hide(),$(".plastic-card__logo_mastercard").show()),console.log(t[0])},cardVer=e=>{const t=document.querySelector(e),a=new FormData(t),o=Array.from(a).map(((e,t)=>{if(0===t){const t=e[1].replace(/\s/g,"").split(""),a=t.map(((e,a)=>t.length-4>a?null:e));return a.join("")}return e[1]}));console.log(o[0],o[1],o[2]),$(".plastic-card__num").text(`**** **** **** ${o[0]}`),$(".plastic-card__name").text(`${o[1]}`),$(".plastic-card__date").text(`${o[2]}`)};$("#edit-card").on("click",(e=>{cardVer("#card-ver_form")})),$("#card-verification__btn").on("click",(function(e){e.preventDefault(),cardVer("#card-ver_form"),$(".plastic-card").addClass("filed"),$("#edit-card").css("display","block"),$("#card-verification__btn").hide(),nextStep(2),$("#step_2-photo-do").prop("disabled",!1),webcamStartFirst()}));const maxLength=(e,t)=>e.length>t?e.slice(0,t):e,addWhitespace=(e,t)=>{let a=e.split("");a.join("").replace(/\s/g,"").split("").length%4==0&&a.push(" "),t.value=a.join("")},addSlash=(e,t)=>{let a=e.split("");2===a.length&&a.push("/"),t.value=a.join("")};inpCardNum.addEventListener("input",(e=>{const t=e.target.value;addWhitespace(maxLength(t,20),e.target),setCardLogo(t)})),inpCardDate.addEventListener("input",(e=>{const t=e.target.value;addSlash(maxLength(t,5),e.target)})),inpCardCvv.addEventListener("input",(e=>{e.target.value=maxLength(e.target.value,3)}));