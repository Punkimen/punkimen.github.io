import"custom-event-polyfill";const defaultParams={containerClass:"custom-select-container",openerClass:"custom-select-opener",panelClass:"custom-select-panel",optionClass:"custom-select-option",optgroupClass:"custom-select-optgroup",isSelectedClass:"is-selected",hasFocusClass:"has-focus",isDisabledClass:"is-disabled",isOpenClass:"is-open"};function builder(e,t){const s="customSelect";let n=!1,o="";const l=e;let a,i,c,r,d,u,p,m="";function f(e){c&&c.classList.remove(t.hasFocusClass),void 0!==e?(c=e,c.classList.add(t.hasFocusClass),n&&(e.offsetTop<e.offsetParent.scrollTop||e.offsetTop>e.offsetParent.scrollTop+e.offsetParent.clientHeight-e.clientHeight)&&e.dispatchEvent(new CustomEvent("custom-select:focus-outside-panel",{bubbles:!0}))):c=void 0}function C(e){r&&(r.classList.remove(t.isSelectedClass),r.removeAttribute("id"),i.removeAttribute("aria-activedescendant")),void 0!==e?(e.classList.add(t.isSelectedClass),e.setAttribute("id",`customSelect-${o}-selectedOption`),i.setAttribute("aria-activedescendant",`customSelect-${o}-selectedOption`),r=e,i.children[0].textContent=r.customSelectOriginalOption.text):(r=void 0,i.children[0].textContent=""),f(e)}function g(e){const t=[].indexOf.call(l.options,c.customSelectOriginalOption);l.options[t+e]&&f(l.options[t+e].customSelectCstOption)}function h(e){if(e||void 0===e){const e=document.querySelector(`.customSelect.${t.isOpenClass}`);e&&(e.customSelect.open=!1),a.classList.add(t.isOpenClass),a.classList.add(t.isOpenClass),i.setAttribute("aria-expanded","true"),r&&(d.scrollTop=r.offsetTop),a.dispatchEvent(new CustomEvent("custom-select:open")),n=!0}else a.classList.remove(t.isOpenClass),i.setAttribute("aria-expanded","false"),n=!1,f(r),a.dispatchEvent(new CustomEvent("custom-select:close"));return n}function v(e){e.target===i||i.contains(e.target)?n?h(!1):h():e.target.classList&&e.target.classList.contains(t.optionClass)&&d.contains(e.target)?(C(e.target),r.customSelectOriginalOption.selected=!0,h(!1),l.dispatchEvent(new CustomEvent("change"))):e.target===l?i!==document.activeElement&&l!==document.activeElement&&i.focus():n&&!a.contains(e.target)&&h(!1)}function b(e){e.target.classList&&e.target.classList.contains(t.optionClass)&&f(e.target)}function E(e){if(n)switch(e.keyCode){case 13:case 32:C(c),r.customSelectOriginalOption.selected=!0,l.dispatchEvent(new CustomEvent("change")),h(!1);break;case 27:h(!1);break;case 38:g(-1);break;case 40:g(1);break;default:if(e.keyCode>=48&&e.keyCode<=90){p&&clearTimeout(p),p=setTimeout((()=>{m=""}),1500),m+=String.fromCharCode(e.keyCode);for(let e=0,t=l.options.length;e<t;e++)if(l.options[e].text.toUpperCase().substr(0,m.length)===m){f(l.options[e].customSelectCstOption);break}}}else 40!==e.keyCode&&38!==e.keyCode&&32!==e.keyCode||h()}function O(){const e=l.selectedIndex;C(-1===e?void 0:l.options[e].customSelectCstOption)}function S(e){const t=e.currentTarget,s=e.target;s.offsetTop<t.scrollTop?t.scrollTop=s.offsetTop:t.scrollTop=s.offsetTop+s.clientHeight-t.clientHeight}function L(){document.addEventListener("click",v),d.addEventListener("mouseover",b),d.addEventListener("custom-select:focus-outside-panel",S),l.addEventListener("change",O),a.addEventListener("keydown",E)}function T(){document.removeEventListener("click",v),d.removeEventListener("mouseover",b),d.removeEventListener("custom-select:focus-outside-panel",S),l.removeEventListener("change",O),a.removeEventListener("keydown",E)}function A(e){const s=e,n=[];if(void 0===s.length)throw new TypeError("Invalid Argument");for(let e=0,o=s.length;e<o;e++)if(s[e]instanceof HTMLElement&&"OPTGROUP"===s[e].tagName.toUpperCase()){const o=document.createElement("div");o.classList.add(t.optgroupClass),o.setAttribute("data-label",s[e].label),o.customSelectOriginalOptgroup=s[e],s[e].customSelectCstOptgroup=o;const l=A(s[e].children);for(let e=0,t=l.length;e<t;e++)o.appendChild(l[e]);n.push(o)}else{if(!(s[e]instanceof HTMLElement&&"OPTION"===s[e].tagName.toUpperCase()))throw new TypeError("Invalid Argument");{const o=document.createElement("div");o.classList.add(t.optionClass),o.textContent=s[e].text,o.setAttribute("data-value",s[e].value),o.setAttribute("role","option"),o.customSelectOriginalOption=s[e],s[e].customSelectCstOption=o,s[e].selected&&C(o),n.push(o)}}return n}function y(e,t,s){let n;if(void 0===s||s===l)n=d;else{if(!(s instanceof HTMLElement&&"OPTGROUP"===s.tagName.toUpperCase()&&l.contains(s)))throw new TypeError("Invalid Argument");n=s.customSelectCstOptgroup}const o=e instanceof HTMLElement?[e]:e;if(t)for(let e=0,t=o.length;e<t;e++)n===d?l.appendChild(o[e]):n.customSelectOriginalOptgroup.appendChild(o[e]);const a=A(o);for(let e=0,t=a.length;e<t;e++)n.appendChild(a[e]);return o}a=document.createElement("div"),a.classList.add(t.containerClass,s),i=document.createElement("span"),i.className=t.openerClass,i.setAttribute("role","combobox"),i.setAttribute("aria-autocomplete","list"),i.setAttribute("aria-expanded","false"),i.innerHTML=`<span>\n   ${-1!==l.selectedIndex?l.options[l.selectedIndex].text:""}\n   </span>`,d=document.createElement("div");const N="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let e=0;e<5;e++)o+=N.charAt(Math.floor(Math.random()*N.length));return d.id=`customSelect-${o}-panel`,d.className=t.panelClass,d.setAttribute("role","listbox"),i.setAttribute("aria-owns",d.id),y(l.children,!1),a.appendChild(i),l.parentNode.replaceChild(a,l),a.appendChild(l),a.appendChild(d),document.querySelector(`label[for="${l.id}"]`)?u=document.querySelector(`label[for="${l.id}"]`):"LABEL"===a.parentNode.tagName.toUpperCase()&&(u=a.parentNode),void 0!==u&&(u.setAttribute("id",`customSelect-${o}-label`),i.setAttribute("aria-labelledby",`customSelect-${o}-label`)),l.disabled?a.classList.add(t.isDisabledClass):(i.setAttribute("tabindex","0"),l.setAttribute("tabindex","-1"),L()),a.customSelect={get pluginOptions(){return t},get open(){return n},set open(e){h(e)},get disabled(){return l.disabled},set disabled(e){!function(e){e&&!l.disabled?(a.classList.add(t.isDisabledClass),l.disabled=!0,i.removeAttribute("tabindex"),a.dispatchEvent(new CustomEvent("custom-select:disabled")),T()):!e&&l.disabled&&(a.classList.remove(t.isDisabledClass),l.disabled=!1,i.setAttribute("tabindex","0"),a.dispatchEvent(new CustomEvent("custom-select:enabled")),L())}(e)},get value(){return l.value},set value(e){!function(e){let t=l.querySelector(`option[value='${e}']`);t||([t]=l.options),t.selected=!0,C(l.options[l.selectedIndex].customSelectCstOption)}(e)},append:(e,t)=>y(e,!0,t),insertBefore:(e,t)=>function(e,t){let s;if(t instanceof HTMLElement&&"OPTION"===t.tagName.toUpperCase()&&l.contains(t))s=t.customSelectCstOption;else{if(!(t instanceof HTMLElement&&"OPTGROUP"===t.tagName.toUpperCase()&&l.contains(t)))throw new TypeError("Invalid Argument");s=t.customSelectCstOptgroup}const n=A(e.length?e:[e]);return s.parentNode.insertBefore(n[0],s),t.parentNode.insertBefore(e.length?e[0]:e,t)}(e,t),remove:function(e){let t;if(e instanceof HTMLElement&&"OPTION"===e.tagName.toUpperCase()&&l.contains(e))t=e.customSelectCstOption;else{if(!(e instanceof HTMLElement&&"OPTGROUP"===e.tagName.toUpperCase()&&l.contains(e)))throw new TypeError("Invalid Argument");t=e.customSelectCstOptgroup}t.parentNode.removeChild(t);const s=e.parentNode.removeChild(e);return O(),s},empty:function(){const e=[];for(;l.children.length;)d.removeChild(d.children[0]),e.push(l.removeChild(l.children[0]));return C(),e},destroy:function(){for(let e=0,t=l.options.length;e<t;e++)delete l.options[e].customSelectCstOption;const e=l.getElementsByTagName("optgroup");for(let t=0,s=e.length;t<s;t++)delete e.customSelectCstOptgroup;return T(),a.parentNode.replaceChild(l,a)},opener:i,select:l,panel:d,container:a},l.customSelect=a.customSelect,a.customSelect}export default function customSelect(e,t){const s=[],n=[];return function(){if(e&&e instanceof HTMLElement&&"SELECT"===e.tagName.toUpperCase())s.push(e);else if(e&&"string"==typeof e){const t=document.querySelectorAll(e);for(let e=0,n=t.length;e<n;++e)t[e]instanceof HTMLElement&&"SELECT"===t[e].tagName.toUpperCase()&&s.push(t[e])}else if(e&&e.length)for(let t=0,n=e.length;t<n;++t)e[t]instanceof HTMLElement&&"SELECT"===e[t].tagName.toUpperCase()&&s.push(e[t]);for(let e=0,o=s.length;e<o;++e)n.push(builder(s[e],Object.assign({},defaultParams,t)));return n}()}